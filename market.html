<!DOCTYPE html>
<html>
    <head>
        <title>Pirates</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <style>
        p {padding: 0px;}
    </style>
    <body>
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <a class="navbar-brand" href="index.html">Home</a>
                <div class="collapse navbar-collapse" id="menu">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a href="market.html" class="nav-link">Market</a>
                        </li>
                        <li class="nav-item">
                            <a href="landlubber_crew.html" class="nav-link">Crew</a>
                        </li>
                        <li class="nav-item">
                            <a href="landlubber_inventory.html" class="nav-link">Inventory</a>
                        </li>
                        <li class="nav-item">
                            <a href="inn.html" class="nav-link">Inn</a>
                        </li>
                        <li class="nav-item">
                            <a href="awards.html" class="nav-link">Bank</a>
                        </li>
                        <a class="btn btn-danger" href="navigation.html" role="button">Return to Ship</a>
                    </ul>
                </div>
            </nav>

            <div class="pt-3">
                <!-- Content starts here -->
                <h1>Captain,</h1>
                <!-- Content ends here -->
            </div>
            <div class="pt-3">
                <p class = "lead" id = "doubloons"></p>
                <p class="lead" id = "spice"></p>
                <p class="lead" id = "inventory-spices"></p>
                <button type="button" onclick = "buy('Spices')" class="btn btn-primary">Buy Spices</button>
                <button type="button" onclick = "buyMax('Spices')" class="btn btn-primary">Buy Maximum Spices</button>
                <button type="button" onclick = "sell('Spices')" class="btn btn-primary">Sell Spices</button>
                <button type="button" onclick = "sellAll('Spices')" class="btn btn-primary">Sell All Spices</button>
                <p class="lead" id = "gold"></p>
                <p class="lead" id = "inventory-gold"></p>
                <button type="button" onclick = "buy('Gold')" class="btn btn-primary">Buy Gold</button>
                <button type="button" onclick = "buyMax('Gold')" class="btn btn-primary">Buy Maximum Gold</button>
                <button type="button" onclick = "sell('Gold')" class="btn btn-primary">Sell Gold</button>
                <button type="button" onclick = "sellAll('Gold')" class="btn btn-primary">Sell All Gold</button>
                <p class="lead" id = "rum"></p>
                <p class="lead" id = "inventory-rum"></p>
                <button type="button" onclick = "buy('Rum')" class="btn btn-primary">Buy Rum</button>
                <button type="button" onclick = "buyMax('Rum')" class="btn btn-primary">Buy Maximum Rum</button>
                <button type="button" onclick = "sell('Rum')" class="btn btn-primary">Sell Rum</button>
                <button type="button" onclick = "sellAll('Rum')" class="btn btn-primary">Sell All Rum</button>
                <p class="lead" id = "opium"></p>
                <p class="lead" id = "inventory-opium"></p>
                <button type="button" onclick = "buy('Opium')" class="btn btn-primary">Buy Opium</button>
                <button type="button" onclick = "buyMax('Opium')" class="btn btn-primary">Buy Maximum Opium</button>
                <button type="button" onclick = "sell('Opium')" class="btn btn-primary">Sell Opium</button>
                <button type="button" onclick = "sellAll('Opium')" class="btn btn-primary">Sell All Opium</button>
                <p class="lead" id = "tobacco"></p>
                <p class="lead" id = "inventory-tobacco"></p>
                <button type="button" onclick = "buy('Tobacco')" class="btn btn-primary">Buy Tobacco</button>
                <button type="button" onclick = "buyMax('Tobacco')" class="btn btn-primary">Buy Maximum Tobacco</button>
                <button type="button" onclick = "sell('Tobacco')" class="btn btn-primary">Sell Tobacco</button>
                <button type="button" onclick = "sellAll('Tobacco')" class="btn btn-primary">Sell All Tobacco</button>
                <p class="lead" id = "sugar"></p>
                <p class="lead" id = "inventory-sugar"></p>
                <button type="button" onclick = "buy('Sugar')" class="btn btn-primary">Buy Sugar</button>
                <button type="button" onclick = "buyMax('Sugar')" class="btn btn-primary">Buy Maximum Sugar</button>
                <button type="button" onclick = "sell('Sugar')" class="btn btn-primary">Sell Sugar</button>
                <button type="button" onclick = "sellAll('Sugar')" class="btn btn-primary">Sell All Sugar</button>
                <!-- <script>
                    document.write("Due to local conflicts, the price of guns has skyrocketed.")
                </script>
                <p class="lead">Due to local conflicts, the price of guns has skyrocketed.</p>
                <p class="lead">Traders have flooded the local market with gold, causing the price to become low.</p>
                <p class="lead">The bank is demanding you pay your debt (51,234 doubloons).</p>
              </div> -->
        </div>
    </body>
    <script>
        var prices = JSON.parse(localStorage.getItem("prices"));
        var keys = Object.keys(prices);
        var city = localStorage.getItem("nextCity");
        document.getElementById("doubloons").innerHTML = "Doubloons: " + localStorage.getItem("doubloons");
        document.getElementById("spice").innerHTML = "Price of spices (1kg): " + prices[city][0] + " doubloons";
        document.getElementById("gold").innerHTML = "Price of gold (1kg): " + prices[city][1] + " doubloons";
        document.getElementById("rum").innerHTML = "Price of rum (1kg): " + prices[city][2] + " doubloons";
        document.getElementById("opium").innerHTML = "Price of opium (1kg): " + prices[city][3] + " doubloons";
        document.getElementById("tobacco").innerHTML = "Price of tobacco (1kg): " + prices[city][4] + " doubloons";
        document.getElementById("sugar").innerHTML = "Price of sugar (1kg): " + prices[city][5] + " doubloons";
        document.getElementById("inventory-gold").innerHTML = "Gold: " + JSON.parse(localStorage.getItem("inventory"))["Gold"];
        document.getElementById("inventory-spices").innerHTML = "Spices: " + JSON.parse(localStorage.getItem("inventory"))["Spices"];
        document.getElementById("inventory-rum").innerHTML = "Rum: " + JSON.parse(localStorage.getItem("inventory"))["Rum"];
        document.getElementById("inventory-opium").innerHTML = "Opium: " + JSON.parse(localStorage.getItem("inventory"))["Opium"];
        document.getElementById("inventory-tobacco").innerHTML = "Tobacco: " + JSON.parse(localStorage.getItem("inventory"))["Tobacco"];
        document.getElementById("inventory-sugar").innerHTML = "Sugar: " + JSON.parse(localStorage.getItem("inventory"))["Sugar"];
        function refreshBalance() {
            //document.getElementById("inventory-doubloons").innerHTML = "Doubloons: " + localStorage.getItem("doubloons");
            document.getElementById("doubloons").innerHTML = "Doubloons: " + localStorage.getItem("doubloons");
            document.getElementById("inventory-gold").innerHTML = "Gold: " + JSON.parse(localStorage.getItem("inventory"))["Gold"];
            document.getElementById("inventory-spices").innerHTML = "Spices: " + JSON.parse(localStorage.getItem("inventory"))["Spices"];
            document.getElementById("inventory-rum").innerHTML = "Rum: " + JSON.parse(localStorage.getItem("inventory"))["Rum"];
            document.getElementById("inventory-opium").innerHTML = "Opium: " + JSON.parse(localStorage.getItem("inventory"))["Opium"];
            document.getElementById("inventory-tobacco").innerHTML = "Tobacco: " + JSON.parse(localStorage.getItem("inventory"))["Tobacco"];
            document.getElementById("inventory-sugar").innerHTML = "Sugar: " + JSON.parse(localStorage.getItem("inventory"))["Sugar"];
        }
        function buy(item) {
            var inventory = JSON.parse(localStorage.getItem("inventory"));
            var doubloons = parseInt(localStorage.getItem("doubloons"));
            var num;
            if(item == 'Spices')
                num = 0;
            else if(item == 'Gold')
                num = 1;
            else if(item == 'Rum')
                num = 2;
            else if(item == 'Opium')
                num = 3;
            else if(item == 'Tobacco')
                num = 4;
            else if(item == 'Sugar')
                num = 5;
            if(doubloons < prices[city][num])
                return;
            else
            {
                inventory[item] += 1;
                doubloons -= prices[city][num];
            }
            localStorage.setItem("inventory", JSON.stringify(inventory));
            localStorage.setItem("doubloons", doubloons);
            refreshBalance();
        }
        function buyMax(item) {
            var inventory = JSON.parse(localStorage.getItem("inventory"));
            var doubloons = parseInt(localStorage.getItem("doubloons"));
            var num;
            if(item == 'Spices')
                num = 0;
            else if(item == 'Gold')
                num = 1;
            else if(item == 'Rum')
                num = 2;
            else if(item == 'Opium')
                num = 3;
            else if(item == 'Tobacco')
                num = 4;
            else if(item == 'Sugar')
                num = 5;
            if(doubloons < prices[city][num])
                return;
            else
            {
                var quantity = Math.floor(doubloons/prices[city][num]);
                inventory[item] += quantity;
                doubloons -= quantity * prices[city][num];
            }
            localStorage.setItem("inventory", JSON.stringify(inventory));
            localStorage.setItem("doubloons", doubloons);
            refreshBalance();
        }
        function sell(item) {
            var morale = parseInt(localStorage.getItem("morale"));
            var crew = JSON.parse(localStorage.getItem("crew"));
            var numCrew = crew.length;
            if(numCrew == 0)
                numCrew = 1;
            var inventory = JSON.parse(localStorage.getItem("inventory"));
            var doubloons = parseInt(localStorage.getItem("doubloons"));
            var num;
            if(item == 'Spices')
                num = 0;
            else if(item == 'Gold')
                num = 1;
            else if(item == 'Rum')
                num = 2;
            else if(item == 'Opium')
                num = 3;
            else if(item == 'Tobacco')
                num = 4;
            else if(item == 'Sugar')
                num = 5;
            if(inventory[item] == 0)
                return;
            else
            {
                inventory[item] -= 1;
                morale += Math.ceil(prices[city][num] * .075/numCrew);
                doubloons += Math.ceil(prices[city][num] * .85);
            }
            localStorage.setItem("inventory", JSON.stringify(inventory));
            localStorage.setItem("doubloons", doubloons);
            localStorage.setItem("morale", morale);
            refreshBalance();
        }
        function sellAll(item) {
            var morale = parseInt(localStorage.getItem("morale"));
            var crew = JSON.parse(localStorage.getItem("crew"));
            var numCrew = crew.length;
            if(numCrew == 0)
                numCrew = 1;
            var inventory = JSON.parse(localStorage.getItem("inventory"));
            var doubloons = parseInt(localStorage.getItem("doubloons"));
            var num;
            if(item == 'Spices')
                num = 0;
            else if(item == 'Gold')
                num = 1;
            else if(item == 'Rum')
                num = 2;
            else if(item == 'Opium')
                num = 3;
            else if(item == 'Tobacco')
                num = 4;
            else if(item == 'Sugar')
                num = 5;
            if(inventory[item] == 0)
                return;
            else
            {
                
                doubloons += Math.ceil(prices[city][num] * inventory[item] * .85);
                morale += Math.ceil(prices[city][num] * inventory[item] * .075/numCrew);
                inventory[item] = 0;
            }
            localStorage.setItem("inventory", JSON.stringify(inventory));
            localStorage.setItem("doubloons", doubloons);
            localStorage.setItem("morale", morale);
            refreshBalance();
        }
    </script>
</html>